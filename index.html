<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>His Master‚Äôs Open Voices ‚Äì Kor-radio</title>
  <style>
    :root{
      --bg:#f3efe7;
      --wood1:#8a5632;
      --wood2:#6f4022;
      --wood3:#5a3118;

      --frame:#f1eef2;
      --frame2:#ded8dc;

      --glass1:#e7e1d6;
      --glass2:#cfc6b6;

      --speaker1:#d8c49b;
      --speaker2:#c9b07c;

      --ink:#1a1410;
      --muted:#6a5a4c;

      --accent:#9c1b1b;
      --shadow: 0 20px 50px rgba(0,0,0,.22);
      --shadow2: inset 0 10px 24px rgba(0,0,0,.18);

      --r: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 600px at 30% 0%, #fff, transparent 60%),
                  linear-gradient(180deg, #fbf7ef, var(--bg));
      color: var(--ink);
      padding: 14px;
      display:flex;
      justify-content:center;
    }

    /* Mobile-first layout */
    .wrap{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      align-items:start;
    }

    @media (min-width: 980px){
      body{ padding: 22px; }
      .wrap{
        grid-template-columns: 1.25fr .75fr;
        gap: 18px;
      }
    }

    /* ===== RADIO CABINET ===== */
    .cabinet{
      border-radius: 28px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.18), transparent 45%),
        linear-gradient(135deg, var(--wood1), var(--wood2) 55%, var(--wood3));
      border: 1px solid rgba(0,0,0,.25);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      padding: 14px;
    }

    /* wood grain overlay */
    .cabinet::before{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(90deg,
          rgba(0,0,0,.05) 0 2px,
          rgba(255,255,255,.02) 2px 6px,
          rgba(0,0,0,.03) 6px 11px);
      opacity:.35;
      mix-blend-mode:multiply;
      pointer-events:none;
    }

    .radioInner{
      position:relative;
      z-index:1;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.04));
      border: 1px solid rgba(255,255,255,.18);
      padding: 12px;
    }

    /* Top row: little title + power */
    .topBar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
      user-select:none;
    }
    .brandPill{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      border: 1px solid rgba(0,0,0,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
      min-width:0;
    }
    .badge{
      width: 32px; height: 32px;
      border-radius: 10px;
      background: linear-gradient(180deg, var(--frame), var(--frame2));
      border: 1px solid rgba(0,0,0,.22);
      display:grid;
      place-items:center;
      font-weight: 900;
      color: rgba(0,0,0,.62);
      letter-spacing:.08em;
      text-shadow: 0 1px 0 rgba(255,255,255,.55);
      flex:0 0 auto;
    }
    .brandTxt{ min-width:0; }
    .brandTxt b{
      display:block;
      font-size: 12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(255,255,255,.88);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brandTxt span{
      display:block;
      font-size: 12px;
      color: rgba(255,255,255,.70);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .powerBtn{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.20);
      background: linear-gradient(180deg, var(--frame), var(--frame2));
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      cursor:pointer;
      user-select:none;
      font-weight: 900;
      color: rgba(0,0,0,.68);
    }
    .powerDot{
      width: 10px; height: 10px; border-radius:999px;
      background: rgba(0,0,0,.25);
      box-shadow: inset 0 2px 6px rgba(0,0,0,.25);
    }
    .powerOn .powerDot{
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(156,27,27,.15), 0 8px 18px rgba(156,27,27,.28);
    }

    /* Windows row */
    .windows{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 640px){
      .windows{ grid-template-columns: 1fr 1fr; }
    }

    .windowFrame{
      border-radius: 20px;
      background: linear-gradient(180deg, var(--frame), var(--frame2));
      border: 1px solid rgba(0,0,0,.20);
      box-shadow: inset 0 2px 0 rgba(255,255,255,.45);
      padding: 10px;
      position:relative;
      overflow:hidden;
    }

    .windowInset{
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.18);
      box-shadow: inset 0 10px 22px rgba(0,0,0,.10);
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.35), rgba(0,0,0,.06));
    }

    /* Left: speaker + logo */
    .speaker{
      min-height: 190px;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,.16), transparent 45%),
        repeating-linear-gradient(0deg, rgba(0,0,0,.12) 0 1px, rgba(255,255,255,.05) 1px 6px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.08) 0 1px, rgba(255,255,255,.03) 1px 7px),
        linear-gradient(180deg, var(--speaker1), var(--speaker2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 14px;
      position:relative;
    }

    .logoPlate{
      width: 92%;
      max-width: 360px;
      border-radius: 12px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(0,0,0,.18);
      box-shadow: inset 0 2px 0 rgba(255,255,255,.25);
      padding: 10px 12px;
      position:relative;
    }

    .logoPlate::before{
      content:"";
      position:absolute;
      inset: -10px -18px auto auto;
      width: 160px; height: 90px;
      background: linear-gradient(180deg, rgba(255,255,255,.35), transparent);
      transform: rotate(18deg);
      opacity:.35;
      pointer-events:none;
    }

    .logoText{
      font-family: "Georgia", "Times New Roman", serif;
      text-transform:uppercase;
      letter-spacing:.14em;
      font-weight: 800;
      font-size: 14px;
      color: rgba(0,0,0,.65);
      text-align:center;
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
      line-height:1.2;
    }
    .logoSub{
      margin-top: 6px;
      font-family: "Georgia", "Times New Roman", serif;
      letter-spacing:.12em;
      font-size: 11px;
      color: rgba(0,0,0,.55);
      text-align:center;
    }

    .logoOrn{
      margin-top: 8px;
      height: 12px;
      position:relative;
      opacity:.65;
    }
    .logoOrn::before,
    .logoOrn::after{
      content:"";
      position:absolute;
      top:50%;
      width: 42%;
      height: 2px;
      background: rgba(0,0,0,.45);
      transform: translateY(-50%);
    }
    .logoOrn::before{ left:0; }
    .logoOrn::after{ right:0; }
    .logoOrn span{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%);
      width: 12px; height: 12px;
      border: 2px solid rgba(0,0,0,.45);
      border-radius: 999px;
    }

    /* Right: tuner scale */
    .tuner{
      min-height: 190px;
      background:
        radial-gradient(circle at 15% 15%, rgba(255,255,255,.35), transparent 55%),
        linear-gradient(180deg, var(--glass1), var(--glass2));
      padding: 10px 12px;
      position:relative;
      user-select:none;
    }

    .tunerTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      font-family: "Georgia", "Times New Roman", serif;
      font-size: 11px;
      letter-spacing:.10em;
      color: rgba(0,0,0,.58);
      text-transform:uppercase;
    }
    .tunerMid{
      margin-top: 10px;
      border-radius: 12px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(0,0,0,.18);
      padding: 10px;
      position:relative;
      overflow:hidden;
    }
    .scale{
      display:flex;
      justify-content:space-between;
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.08em;
      color: rgba(0,0,0,.62);
    }
    .ticks{
      margin-top: 8px;
      height: 18px;
      background:
        repeating-linear-gradient(90deg, rgba(0,0,0,.55) 0 1px, transparent 1px 8px);
      opacity:.55;
      border-radius: 6px;
    }
    .needle{
      position:absolute;
      top: 8px;
      bottom: 8px;
      width: 2px;
      left: 10px;
      background: var(--accent);
      box-shadow: 0 0 0 1px rgba(255,255,255,.55);
      border-radius: 2px;
      pointer-events:none;
    }
    .tunerBottom{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-top: 10px;
      font-size: 11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(0,0,0,.58);
      font-family: "Georgia", "Times New Roman", serif;
    }

    /* Controls: knobs */
    .knobs{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 640px){
      .knobs{ grid-template-columns: 1fr; }
    }

    .controlRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }

    .now{
      min-width: 0;
      flex: 1 1 auto;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(0,0,0,.18);
      color: rgba(255,255,255,.88);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.20);
    }
    .now b{
      display:block;
      font-size: 14px;
      letter-spacing:.02em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .now small{
      display:block;
      margin-top:4px;
      font-size: 12px;
      color: rgba(255,255,255,.70);
      line-height:1.2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .status{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(255,255,255,.68);
    }

    .buttons{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      border: 1px solid rgba(0,0,0,.22);
      background: linear-gradient(180deg, var(--frame), var(--frame2));
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      cursor:pointer;
      user-select:none;
      color: rgba(0,0,0,.70);
      font-weight: 900;
    }
    .btn:active{ transform: translateY(1px); }
    .btnRound{
      width: 52px; height: 52px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-size: 16px;
    }
    .btnPlay{
      padding: 12px 14px;
      border-radius: 999px;
      border: 2px solid rgba(156,27,27,.32);
      font-size: 14px;
    }
    .toggleOn{
      outline: 3px solid rgba(156,27,27,.14);
    }

    .knobStrip{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }

    .knob{
      border-radius: 999px;
      aspect-ratio: 1/1;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 55%),
                  linear-gradient(180deg, var(--frame), var(--frame2));
      border: 1px solid rgba(0,0,0,.22);
      box-shadow: 0 16px 26px rgba(0,0,0,.20), inset 0 2px 0 rgba(255,255,255,.45);
      position:relative;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .knob::after{
      content:"";
      width: 3px; height: 38%;
      background: rgba(0,0,0,.45);
      border-radius: 2px;
      position:absolute;
      top: 12%;
      box-shadow: 0 1px 0 rgba(255,255,255,.35);
      opacity:.85;
      transform: rotate(var(--ang, -25deg));
      transform-origin: center 70%;
    }
    .knobLabel{
      position:absolute;
      bottom: -22px;
      left:50%;
      transform: translateX(-50%);
      font-size: 10px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(255,255,255,.72);
      user-select:none;
      white-space:nowrap;
    }

    .progressWrap{
      margin-top: 10px;
    }
    .bar{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(0,0,0,.18);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(156,27,27,.75), rgba(156,27,27,.20));
    }
    .timeRow{
      margin-top: 6px;
      display:flex;
      justify-content:space-between;
      font-size: 12px;
      color: rgba(255,255,255,.70);
      user-select:none;
    }

    .bottomRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 10px;
      color: rgba(255,255,255,.72);
      font-size: 12px;
    }

    .volPill{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(0,0,0,.18);
      user-select:none;
    }
    input[type="range"]{ width: 180px; }

    .link{
      color: rgba(255,255,255,.78);
      text-decoration:none;
      border-bottom: 1px dashed rgba(255,255,255,.35);
    }

    /* ===== PLAYLIST ===== */
    .book{
      border-radius: 18px;
      background: linear-gradient(180deg, #fffaf0, #f2eadc);
      border: 1px solid rgba(0,0,0,.12);
      box-shadow: 0 16px 38px rgba(0,0,0,.12);
      padding: 14px;
    }
    .book h2{
      margin:0 0 10px;
      font-size: 14px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(0,0,0,.65);
    }
    .list{
      margin:0;
      padding:0;
      list-style:none;
      display:grid;
      gap:8px;
      max-height: 360px; /* mobile */
      overflow:auto;
      padding-right: 6px;
    }
    @media (min-width: 980px){
      .list{ max-height: 560px; }
    }
    .item{
      display:flex;
      gap:10px;
      align-items:center;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.65);
      cursor:pointer;
      user-select:none;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(0,0,0,.22);
      flex:0 0 auto;
    }
    .item.active{
      background: rgba(156,27,27,.10);
      border-color: rgba(156,27,27,.22);
    }
    .item.active .dot{
      background: var(--accent);
      box-shadow: 0 6px 14px rgba(156,27,27,.22);
    }
    .itemTitle{
      font-weight: 900;
      font-size: 13px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .itemSub{
      font-size: 12px;
      color: rgba(0,0,0,.55);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .note{
      margin-top:10px;
      font-size:12px;
      color: rgba(0,0,0,.55);
      line-height:1.35;
    }

    /* Power-off dim state */
    .off .radioInner{
      filter: saturate(.7) contrast(.95);
    }
    .off .now,
    .off .status,
    .off .progressWrap,
    .off .bottomRow{
      opacity:.65;
    }
    .off .needle,
    .off .dialNeedle{
      opacity:.45;
    }
    .off .btn,
    .off .knob{
      filter: grayscale(.25);
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- RADIO -->
    <div class="cabinet off" id="cabinet">
      <div class="radioInner">

        <div class="topBar">
          <div class="brandPill">
            <div class="badge">FM</div>
            <div class="brandTxt">
              <b>Kor-radio</b>
              <span>His Master‚Äôs Open Voices</span>
            </div>
          </div>

          <button class="powerBtn" id="btnPower" type="button" aria-pressed="false" title="T√¶nd / sluk">
            <span class="powerDot" id="powerDot"></span>
            <span id="powerLabel">OFF</span>
          </button>
        </div>

        <div class="windows">

          <!-- LEFT: SPEAKER + LOGO -->
          <div class="windowFrame">
            <div class="windowInset speaker" aria-label="H√∏jttaler og logo">
              <div class="logoPlate">
                <div class="logoText">HIS MASTER‚ÄôS<br/>OPEN VOICES</div>
                <div class="logoOrn"><span></span></div>
                <div class="logoSub">√Öbne Stemmer ‚Ä¢ Aller√∏d</div>
              </div>
            </div>
          </div>

          <!-- RIGHT: TUNER -->
          <div class="windowFrame">
            <div class="windowInset tuner" aria-label="Tuner">
              <div class="tunerTop">
                <span>Program / Skala</span>
                <span id="freqReadout">96.0 MHz</span>
              </div>

              <div class="tunerMid">
                <div class="scale">
                  <span>88</span><span>92</span><span>96</span><span>100</span><span>104</span><span>108</span>
                </div>
                <div class="ticks"></div>
                <div class="needle" id="dialNeedle"></div>
              </div>

              <div class="tunerBottom">
                <span>VOL</span>
                <span>SINTONIA</span>
                <span>GAMMA</span>
              </div>
            </div>
          </div>

        </div>

        <!-- Controls + Now Playing -->
        <div class="knobs">
          <div class="controlRow">
            <div class="now" id="nowBox">
              <b id="nowName">Slukket</b>
              <small id="nowMeta">Tryk ON for at t√¶nde</small>
              <div class="status" id="statusHint">Tip: Shuffle giver ‚Äúradio-feeling‚Äù.</div>
            </div>

            <div class="buttons">
              <button class="btn btnRound" id="btnPrev" type="button" title="Forrige">‚üµ</button>
              <button class="btn btnPlay" id="btnPlay" type="button" title="Afspil / Pause">‚ñ∂ Start</button>
              <button class="btn btnRound" id="btnNext" type="button" title="N√¶ste">‚ü∂</button>
              <button class="btn btnRound" id="btnShuffle" type="button" title="Shuffle">üîÄ</button>
              <button class="btn btnRound toggleOn" id="btnLoop" type="button" title="Loop">üîÅ</button>
            </div>
          </div>

          <div class="progressWrap">
            <div class="bar" id="bar"><div id="barFill"></div></div>
            <div class="timeRow"><span id="tCur">0:00</span><span id="tDur">0:00</span></div>
          </div>

          <div class="bottomRow">
            <div class="volPill">
              VOL
              <input id="vol" type="range" min="0" max="1" step="0.01" value="0.85" />
            </div>
            <div>
              <span id="count">0</span> numre ‚Ä¢ <a class="link" href="#" id="openTrack">√Öbn fil</a>
            </div>
          </div>

          <div class="knobStrip" aria-hidden="true">
            <div class="knob" id="k1" style="--ang:-35deg"><span class="knobLabel">VOLUME</span></div>
            <div class="knob" id="k2" style="--ang:-15deg"><span class="knobLabel">TUNING</span></div>
            <div class="knob" id="k3" style="--ang:-25deg"><span class="knobLabel">TONE</span></div>
          </div>
        </div>

        <audio id="audio" preload="metadata"></audio>
      </div>
    </div>

    <!-- PLAYLIST -->
    <div class="book">
      <h2>Playlist</h2>
      <ul class="list" id="list"></ul>
      <div class="note">
        Mobil-tip: Tryk ON ‚Üí v√¶lg sang ‚Üí ‚ñ∂ Start. Autoplay med lyd kr√¶ver normalt et klik.
      </div>
    </div>

  </div>

<script>
  // MP3-filerne ligger i roden (samme mappe som index.html) ‚Äì som p√• dit screenshot.
  const TRACKS = [
    { title: "1. 21-4",                       artist: "√Öbne Stemmer", url: "01-21-4.mp3" },
    { title: "2. Weather With You",           artist: "√Öbne Stemmer", url: "02-weather-with-you.mp3" },
    { title: "3. Fragile",                    artist: "√Öbne Stemmer", url: "03-fragile.mp3" },
    { title: "4. Ordinary World",             artist: "√Öbne Stemmer", url: "04-Ordinary-World.mp3" },
    { title: "5. Det kun vigtigt (hvad det er)", artist: "√Öbne Stemmer", url: "05-det-kun-vigtigt-hvad-det-er.mp3" },
    { title: "6. Frit Land",                  artist: "√Öbne Stemmer", url: "06-frit-land.mp3" },
    { title: "7. I morgen er der osse en dag", artist: "√Öbne Stemmer", url: "07-imorgen-er-der-osse-en-dag.mp3" },
    { title: "8. Africa",                     artist: "√Öbne Stemmer", url: "08-africa.mp3" },
    { title: "9. Afterglow",                  artist: "√Öbne Stemmer", url: "09-afterglow.mp3" }
  ];

  const el = (id)=>document.getElementById(id);

  const cabinet = el("cabinet");
  const btnPower = el("btnPower");
  const powerLabel = el("powerLabel");

  const audio = el("audio");
  const listEl = el("list");
  const nowName = el("nowName");
  const nowMeta = el("nowMeta");
  const statusHint = el("statusHint");
  const btnPlay = el("btnPlay");
  const btnNext = el("btnNext");
  const btnPrev = el("btnPrev");
  const btnShuffle = el("btnShuffle");
  const btnLoop = el("btnLoop");
  const bar = el("bar");
  const barFill = el("barFill");
  const tCur = el("tCur");
  const tDur = el("tDur");
  const vol = el("vol");
  const count = el("count");
  const openTrack = el("openTrack");
  const dialNeedle = el("dialNeedle");
  const freqReadout = el("freqReadout");

  // decorative knobs
  const k1 = el("k1"), k2 = el("k2"), k3 = el("k3");

  let index = 0;
  let isShuffle = false;
  let isLoop = true;
  let isOn = false;

  function fmt(sec){
    if (!isFinite(sec) || sec < 0) return "0:00";
    sec = Math.floor(sec);
    const m = Math.floor(sec/60);
    const s = String(sec%60).padStart(2,"0");
    return `${m}:${s}`;
  }

  function renderList(){
    listEl.innerHTML = "";
    TRACKS.forEach((t,i)=>{
      const li = document.createElement("li");
      li.className = "item";
      li.innerHTML = `
        <span class="dot" aria-hidden="true"></span>
        <div style="min-width:0;">
          <div class="itemTitle">${t.title}</div>
          <div class="itemSub">${t.artist || ""}</div>
        </div>
      `;
      li.addEventListener("click", ()=> load(i, true));
      listEl.appendChild(li);
    });
    count.textContent = TRACKS.length;
  }

  function setActive(){
    [...listEl.children].forEach((li,i)=> li.classList.toggle("active", i===index));
  }

  function moveNeedle(){
    // move needle across tuner (0..1)
    const pct = (index / Math.max(1, TRACKS.length - 1));
    dialNeedle.style.left = `calc(10px + ${pct} * (100% - 20px))`;

    // pseudo frequency readout 88..108
    const freq = 88 + pct * 20;
    freqReadout.textContent = `${freq.toFixed(1)} MHz`;

    // decorative tuning knob rotates
    const ang = -35 + pct * 70; // -35..+35
    k2.style.setProperty("--ang", `${ang}deg`);
  }

  function load(i, autoplay=false){
    if (!isOn){
      statusHint.textContent = "Radioen er slukket. Tryk ON f√∏rst.";
      return;
    }

    index = (i + TRACKS.length) % TRACKS.length;
    const t = TRACKS[index];

    audio.src = t.url;
    nowName.textContent = t.title;
    nowMeta.textContent = t.artist || "";
    openTrack.href = t.url;

    setActive();
    moveNeedle();

    if (autoplay){
      audio.play().then(()=>{
        btnPlay.textContent = "‚è∏ Pause";
        statusHint.textContent = isShuffle ? "Shuffle t√¶ndt ‚Äî radio-feeling!" : "Afspiller i r√¶kkef√∏lge.";
      }).catch(()=>{
        statusHint.textContent = "Klik ‚ñ∂ Start for at afspille (browser kr√¶ver et klik).";
      });
    } else {
      btnPlay.textContent = "‚ñ∂ Start";
      statusHint.textContent = "Tryk ‚ñ∂ Start (autoplay kr√¶ver normalt et klik).";
    }
  }

  function next(){
    if (!isOn) return;
    if (isShuffle && TRACKS.length > 1){
      let n = index;
      while (n === index) n = Math.floor(Math.random()*TRACKS.length);
      load(n, true);
    } else {
      load(index + 1, true);
    }
  }
  function prev(){
    if (!isOn) return;
    load(index - 1, true);
  }

  // ===== Retro click/knas sound (Web Audio) =====
  let AC = null;
  function ensureAudioContext(){
    if (!AC){
      AC = new (window.AudioContext || window.webkitAudioContext)();
    }
    return AC;
  }

  function playClickNoise({on=true}){
    const ac = ensureAudioContext();
    const now = ac.currentTime;

    // master
    const master = ac.createGain();
    master.gain.setValueAtTime(0.0001, now);
    master.connect(ac.destination);

    // short hiss (noise)
    const bufferSize = Math.floor(ac.sampleRate * 0.12); // 120ms
    const buffer = ac.createBuffer(1, bufferSize, ac.sampleRate);
    const data = buffer.getChannelData(0);

    // shaped noise: little ‚Äúknas‚Äù
    for (let i=0; i<bufferSize; i++){
      const t = i / bufferSize;
      // pink-ish-ish: random * (1 - t)^2
      const r = (Math.random()*2 - 1);
      data[i] = r * Math.pow(1 - t, 2) * 0.9;
    }

    const noise = ac.createBufferSource();
    noise.buffer = buffer;

    // bandpass to make it "radio"
    const bp = ac.createBiquadFilter();
    bp.type = "bandpass";
    bp.frequency.setValueAtTime(1200, now);
    bp.Q.setValueAtTime(0.8, now);

    // click transient (osc)
    const click = ac.createOscillator();
    click.type = "square";
    click.frequency.setValueAtTime(on ? 240 : 180, now);

    const clickGain = ac.createGain();
    clickGain.gain.setValueAtTime(0.0, now);
    clickGain.gain.linearRampToValueAtTime(0.12, now + 0.005);
    clickGain.gain.exponentialRampToValueAtTime(0.0001, now + 0.03);

    // noise envelope
    const nGain = ac.createGain();
    nGain.gain.setValueAtTime(0.0001, now);
    nGain.gain.linearRampToValueAtTime(on ? 0.09 : 0.07, now + 0.008);
    nGain.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);

    // slight lowpass to soften
    const lp = ac.createBiquadFilter();
    lp.type = "lowpass";
    lp.frequency.setValueAtTime(4500, now);

    noise.connect(bp);
    bp.connect(nGain);
    nGain.connect(lp);
    lp.connect(master);

    click.connect(clickGain);
    clickGain.connect(master);

    master.gain.exponentialRampToValueAtTime(1.0, now + 0.01);
    master.gain.exponentialRampToValueAtTime(0.0001, now + 0.16);

    noise.start(now);
    noise.stop(now + 0.13);

    click.start(now);
    click.stop(now + 0.04);
  }

  // ===== Power logic =====
  function setPower(state){
    isOn = state;

    cabinet.classList.toggle("off", !isOn);
    btnPower.classList.toggle("powerOn", isOn);
    btnPower.setAttribute("aria-pressed", isOn ? "true" : "false");
    powerLabel.textContent = isOn ? "ON" : "OFF";

    if (isOn){
      playClickNoise({on:true});
      // set initial UI
      nowName.textContent = TRACKS[index]?.title || "Klar";
      nowMeta.textContent = "V√¶lg sang i playlisten";
      statusHint.textContent = "Tryk ‚ñ∂ Start (autoplay kr√¶ver normalt et klik).";
      moveNeedle();
      openTrack.href = TRACKS[index]?.url || "#";
    } else {
      playClickNoise({on:false});
      audio.pause();
      audio.currentTime = 0;
      btnPlay.textContent = "‚ñ∂ Start";
      nowName.textContent = "Slukket";
      nowMeta.textContent = "Tryk ON for at t√¶nde";
      statusHint.textContent = "Tip: Shuffle giver ‚Äúradio-feeling‚Äù.";
      barFill.style.width = "0%";
      tCur.textContent = "0:00";
      tDur.textContent = "0:00";
    }
  }

  btnPower.addEventListener("click", ()=>{
    // must be a user gesture -> safe to create AudioContext
    ensureAudioContext();
    setPower(!isOn);
  });

  // Playback controls
  btnPlay.addEventListener("click", ()=>{
    if (!isOn){
      statusHint.textContent = "Radioen er slukket. Tryk ON f√∏rst.";
      return;
    }
    if (!audio.src) load(index, false);

    if (audio.paused){
      audio.play().then(()=>{
        btnPlay.textContent = "‚è∏ Pause";
        statusHint.textContent = isShuffle ? "Shuffle t√¶ndt ‚Äî radio-feeling!" : "Afspiller i r√¶kkef√∏lge.";
      }).catch(()=>{
        statusHint.textContent = "Kunne ikke starte. Tjek at mp3-filer kan √•bnes direkte.";
      });
    } else {
      audio.pause();
      btnPlay.textContent = "‚ñ∂ Start";
      statusHint.textContent = "Sat p√• pause.";
    }
  });

  btnNext.addEventListener("click", next);
  btnPrev.addEventListener("click", prev);

  btnShuffle.addEventListener("click", ()=>{
    if (!isOn){
      statusHint.textContent = "Radioen er slukket. Tryk ON f√∏rst.";
      return;
    }
    isShuffle = !isShuffle;
    btnShuffle.classList.toggle("toggleOn", isShuffle);
    statusHint.textContent = isShuffle ? "Shuffle t√¶ndt ‚Äî radio-feeling!" : "Shuffle slukket ‚Äî afspiller i r√¶kkef√∏lge.";
  });

  btnLoop.addEventListener("click", ()=>{
    if (!isOn){
      statusHint.textContent = "Radioen er slukket. Tryk ON f√∏rst.";
      return;
    }
    isLoop = !isLoop;
    btnLoop.classList.toggle("toggleOn", isLoop);
    statusHint.textContent = isLoop ? "Loop t√¶ndt ‚Äî spiller videre." : "Loop slukket ‚Äî stopper efter sidste nummer.";
  });

  // Progress
  audio.addEventListener("timeupdate", ()=>{
    const p = (audio.currentTime / (audio.duration || 1)) * 100;
    barFill.style.width = `${Math.min(100, Math.max(0,p))}%`;
    tCur.textContent = fmt(audio.currentTime);
    tDur.textContent = fmt(audio.duration);
  });

  audio.addEventListener("ended", ()=>{
    if (!isOn) return;
    if (index === TRACKS.length - 1 && !isLoop && !isShuffle){
      btnPlay.textContent = "‚ñ∂ Start";
      statusHint.textContent = "F√¶rdig (loop er slukket).";
      return;
    }
    next();
  });

  bar.addEventListener("click", (e)=>{
    if (!isOn) return;
    const r = bar.getBoundingClientRect();
    const x = (e.clientX - r.left) / r.width;
    if (audio.duration) audio.currentTime = x * audio.duration;
  });

  // Volume + decorative knob rotation
  vol.addEventListener("input", ()=>{
    audio.volume = parseFloat(vol.value);
    const pct = parseFloat(vol.value); // 0..1
    const ang = -35 + pct * 70;
    k1.style.setProperty("--ang", `${ang}deg`);
  });
  audio.volume = parseFloat(vol.value);

  // open track
  openTrack.addEventListener("click", (e)=>{
    if (!openTrack.href || openTrack.href.endsWith("#")) e.preventDefault();
  });

  // Init UI
  renderList();
  setActive();
  moveNeedle();
  // Start OFF
  setPower(false);

  // Mark active item when ON and selecting
  function setActive(){
    [...listEl.children].forEach((li,i)=> li.classList.toggle("active", i===index));
  }

  // When user clicks a playlist item, we keep it OFF-safe in load()
  // Also keep tone knob gently moving with track index for fun:
  function updateToneKnob(){
    const pct = (index / Math.max(1, TRACKS.length - 1));
    const ang = -25 + pct * 50;
    k3.style.setProperty("--ang", `${ang}deg`);
  }
  const origLoad = load;
  load = function(i, autoplay=false){
    index = (i + TRACKS.length) % TRACKS.length;
    setActive();
    updateToneKnob();
    // call original logic using selected index
    // restore chosen index in original function by setting it and passing through
    if (!isOn){
      statusHint.textContent = "Radioen er slukket. Tryk ON f√∏rst.";
      nowName.textContent = TRACKS[index].title;
      nowMeta.textContent = "Klar n√•r du t√¶nder";
      openTrack.href = TRACKS[index].url;
      moveNeedle();
      return;
    }
    // replicate original behavior
    const t = TRACKS[index];
    audio.src = t.url;
    nowName.textContent = t.title;
    nowMeta.textContent = t.artist || "";
    openTrack.href = t.url;
    moveNeedle();
    if (autoplay){
      audio.play().then(()=>{
        btnPlay.textContent = "‚è∏ Pause";
        statusHint.textContent = isShuffle ? "Shuffle t√¶ndt ‚Äî radio-feeling!" : "Afspiller i r√¶kkef√∏lge.";
      }).catch(()=>{
        statusHint.textContent = "Klik ‚ñ∂ Start for at afspille (browser kr√¶ver et klik).";
      });
    } else {
      btnPlay.textContent = "‚ñ∂ Start";
      statusHint.textContent = "Tryk ‚ñ∂ Start (autoplay kr√¶ver normalt et klik).";
    }
  };

  updateToneKnob();
</script>
</body>
</html>
